<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Qu·∫£n l√Ω giao d·ªãch</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <style>
      body {
        padding-bottom: 60px;
      }
      .table-actions button {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <span class="navbar-brand">Tr∆∞·ªùng ƒê·∫°i h·ªçc Th·ªßy l·ª£i</span>
        <form class="d-flex">
          <input
            class="form-control me-2"
            type="search"
            placeholder="Nh·∫≠p n·ªôi dung t√¨m ki·∫øm"
          />
          <button class="btn btn-success">T√åM KI·∫æM</button>
        </form>
      </div>
    </nav>

    <div class="container mt-4">
      <div class="d-flex justify-content-between flex-wrap mb-3">
        <div>
          <button class="btn btn-primary" onclick="openModal()">+ Th√™m</button>
          <button class="btn btn-success" onclick="exportCSV()">
            üìÑ Xu·∫•t CSV
          </button>
        </div>
        <input
          id="searchBox"
          class="form-control w-50"
          placeholder="üîç T√¨m ki·∫øm theo kh√°ch h√†ng, nh√¢n vi√™n, s·ªë ti·ªÅn, ng√†y mua"
        />
      </div>

      <table class="table table-bordered">
        <thead class="table-dark">
          <tr>
            <th>H√†nh ƒë·ªông</th>
            <th>ID</th>
            <th>Kh√°ch h√†ng</th>
            <th>Nh√¢n vi√™n</th>
            <th>S·ªë ti·ªÅn</th>
            <th>Ng√†y mua</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>

      <div class="d-flex justify-content-between">
        <button class="btn btn-danger" onclick="clearAll()">
          üóëÔ∏è X√≥a t·∫•t c·∫£
        </button>
        <div id="summary">1 trong 10 k·∫øt qu·∫£</div>
      </div>

      <ul class="pagination justify-content-center mt-3" id="pagination"></ul>
    </div>

    <div class="modal fade" id="modalForm">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Th√™m giao d·ªãch</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <input
              type="text"
              id="customer"
              class="form-control mb-2"
              placeholder="Kh√°ch h√†ng"
            />
            <input
              type="text"
              id="staff"
              class="form-control mb-2"
              placeholder="Nh√¢n vi√™n"
            />
            <input
              type="number"
              id="amount"
              class="form-control mb-2"
              placeholder="S·ªë ti·ªÅn"
            />
            <div id="errorText" class="text-danger mb-2"></div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              H·ªßy
            </button>
            <button class="btn btn-success" onclick="addTransaction()">
              Th√™m
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-primary text-white text-center py-3 mt-5">
      <div class="container">
        <h5>TR∆Ø·ªúNG ƒê·∫†I H·ªåC TH·ª¶Y L·ª¢I</h5>
        <p>
          ƒê·ªãa ch·ªâ: 175 T√¢y S∆°n, ƒê·ªëng ƒêa, H√† N·ªôi<br />
          ƒêi·ªán tho·∫°i: (024) 38522201 ‚Äì Fax: (024) 35633351<br />
          Email:
          <a href="mailto:phongctctsv@tlu.edu.vn" class="text-white"
            >phongctctsv@tlu.edu.vn</a
          >
        </p>
      </div>
    </footer>

    <script>
      let data = [
        {
          id: 3001,
          customer: "Ng√¥ VƒÉn Minh",
          staff: "L√™ Th·ªã Huy·ªÅn",
          amount: 650000,
          date: "10 Th√°ng 6 2024 9:00",
        },
        {
          id: 3002,
          customer: "Tr·∫ßn Th·ªã Mai",
          staff: "Nguy·ªÖn VƒÉn Long",
          amount: 310000,
          date: "10 Th√°ng 6 2024 9:30",
        },
        {
          id: 3003,
          customer: "L√™ VƒÉn H√≤a",
          staff: "Ph·∫°m Th·ªã Lan",
          amount: 430000,
          date: "10 Th√°ng 6 2024 10:00",
        },
        {
          id: 3004,
          customer: "Ho√†ng Th·ªã H·∫°nh",
          staff: "L√™ Th·ªã Huy·ªÅn",
          amount: 520000,
          date: "10 Th√°ng 6 2024 10:20",
        },
        {
          id: 3005,
          customer: "Ph·∫°m H·ªØu T√†i",
          staff: "Nguy·ªÖn VƒÉn Long",
          amount: 290000,
          date: "10 Th√°ng 6 2024 10:45",
        },
        {
          id: 3006,
          customer: "V√µ Th·ªã Ng·ªçc",
          staff: "Ph·∫°m Th·ªã Lan",
          amount: 800000,
          date: "10 Th√°ng 6 2024 11:00",
        },
        {
          id: 3007,
          customer: "ƒê·∫∑ng VƒÉn Ph√∫c",
          staff: "Nguy·ªÖn VƒÉn Long",
          amount: 360000,
          date: "10 Th√°ng 6 2024 11:20",
        },
        {
          id: 3008,
          customer: "Tr·ªãnh Th·ªã B√≠ch",
          staff: "L√™ Th·ªã Huy·ªÅn",
          amount: 470000,
          date: "10 Th√°ng 6 2024 11:40",
        },
        {
          id: 3009,
          customer: "L√Ω VƒÉn Th·∫Øng",
          staff: "Ph·∫°m Th·ªã Lan",
          amount: 210000,
          date: "10 Th√°ng 6 2024 12:00",
        },
        {
          id: 3010,
          customer: "Nguy·ªÖn Th·ªã Giang",
          staff: "Nguy·ªÖn VƒÉn Long",
          amount: 540000,
          date: "10 Th√°ng 6 2024 12:30",
        },
        {
          id: 3011,
          customer: "B√πi Th·ªã Dung",
          staff: "L√™ Th·ªã Huy·ªÅn",
          amount: 390000,
          date: "10 Th√°ng 6 2024 13:00",
        },
        {
          id: 3012,
          customer: "Tr·∫ßn VƒÉn Hi·∫øu",
          staff: "Ph·∫°m Th·ªã Lan",
          amount: 670000,
          date: "10 Th√°ng 6 2024 13:20",
        },
        {
          id: 3013,
          customer: "Nguy·ªÖn Th·ªã L·ªá",
          staff: "Nguy·ªÖn VƒÉn Long",
          amount: 250000,
          date: "10 Th√°ng 6 2024 13:40",
        },
        {
          id: 3014,
          customer: "ƒê·ªó VƒÉn Khoa",
          staff: "L√™ Th·ªã Huy·ªÅn",
          amount: 460000,
          date: "10 Th√°ng 6 2024 14:00",
        },
        {
          id: 3015,
          customer: "Phan Th·ªã H√≤a",
          staff: "Ph·∫°m Th·ªã Lan",
          amount: 720000,
          date: "10 Th√°ng 6 2024 14:20",
        },
      ];

      let currentPage = 1;
      const perPage = 5;

      function openModal() {
        document.getElementById("customer").value = "";
        document.getElementById("staff").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("errorText").textContent = "";
        new bootstrap.Modal(document.getElementById("modalForm")).show();
      }

      function renderTable() {
        const tbody = document.getElementById("dataBody");
        tbody.innerHTML = "";
        const start = (currentPage - 1) * perPage;
        const pageData = data.slice(start, start + perPage);

        pageData.forEach((t, i) => {
          const row = `<tr>
          <td class="table-actions">
            <button class="btn btn-warning btn-sm" onclick="edit(${
              start + i
            })">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="remove(${
              start + i
            })">üóëÔ∏è</button>
          </td>
          <td>${t.id}</td>
          <td>${t.customer}</td>
          <td>${t.staff}</td>
          <td>${t.amount.toLocaleString()}</td>
          <td>${t.date}</td>
        </tr>`;
          tbody.innerHTML += row;
        });

        document.getElementById("summary").textContent = `${Math.min(
          data.length,
          start + 1
        )}-${Math.min(start + perPage, data.length)} trong ${
          data.length
        } k·∫øt qu·∫£`;
        renderPagination();
      }

      function renderPagination() {
        const total = Math.ceil(data.length / perPage);
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        for (let i = 1; i <= total; i++) {
          const li = document.createElement("li");
          li.className = "page-item" + (i === currentPage ? " active" : "");
          li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
          li.onclick = (e) => {
            e.preventDefault();
            currentPage = i;
            renderTable();
          };
          pagination.appendChild(li);
        }
      }

      function addTransaction() {
        const customer = document.getElementById("customer").value.trim();
        const staff = document.getElementById("staff").value.trim();
        const amount = parseFloat(document.getElementById("amount").value);
        const error = document.getElementById("errorText");

        if (!customer || !staff || isNaN(amount)) {
          error.textContent = "Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng ho·∫∑c sai ƒë·ªãnh d·∫°ng.";
          return;
        }

        data.push({
          id: Math.floor(Math.random() * 9000 + 1000),
          customer,
          staff,
          amount,
          date: new Date().toLocaleString("vi-VN"),
        });
        bootstrap.Modal.getInstance(
          document.getElementById("modalForm")
        ).hide();
        renderTable();
      }

      function remove(index) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a giao d·ªãch n√†y?")) {
          data.splice(index, 1);
          renderTable();
        }
      }

      function clearAll() {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu?")) {
          data = [];
          renderTable();
        }
      }

      function edit(index) {
        const entry = data[index];
        document.getElementById("customer").value = entry.customer;
        document.getElementById("staff").value = entry.staff;
        document.getElementById("amount").value = entry.amount;
        document.getElementById("errorText").textContent = "";

        const modal = new bootstrap.Modal(document.getElementById("modalForm"));
        modal.show();

        document.querySelector("#modalForm .btn-success").onclick =
          function () {
            entry.customer = document.getElementById("customer").value.trim();
            entry.staff = document.getElementById("staff").value.trim();
            entry.amount = parseFloat(document.getElementById("amount").value);
            modal.hide();
            renderTable();
          };
      }

      function exportCSV() {
        let csv = "ID,Kh√°ch h√†ng,Nh√¢n vi√™n,S·ªë ti·ªÅn,Ng√†y mua\n";
        data.forEach((t) => {
          csv += `${t.id},${t.customer},${t.staff},${t.amount},${t.date}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "giao_dich.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      renderTable();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
