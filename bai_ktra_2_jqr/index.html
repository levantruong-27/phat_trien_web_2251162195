<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω giao d·ªãch</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .table-wrapper {
        margin-top: 20px;
      }
      .action-buttons .btn {
        margin-right: 5px;
      }
      .header {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body class="container">
    <div class="header mt-3">
      <h3>Qu·∫£n l√Ω giao d·ªãch</h3>
    </div>

    <!-- Thanh c√¥ng c·ª• -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <div>
        <button
          class="btn btn-success"
          data-toggle="modal"
          data-target="#addModal"
        >
          ‚ûï Th√™m m·ªõi
        </button>
        <button class="btn btn-primary" id="exportCsv">üì§ Xu·∫•t CSV</button>
      </div>
      <input
        type="text"
        id="searchInput"
        class="form-control w-25"
        placeholder="üîç T√¨m ki·∫øm..."
      />
    </div>

    <!-- B·∫£ng d·ªØ li·ªáu -->
    <div class="table-wrapper">
      <table class="table table-bordered table-striped">
        <thead class="thead-dark">
          <tr>
            <th><input type="checkbox" id="selectAll" /></th>
            <th>H√†nh ƒë·ªông</th>
            <th>ID</th>
            <th>Kh√°ch h√†ng</th>
            <th>Nh√¢n vi√™n</th>
            <th>S·ªë ti·ªÅn</th>
            <th>Ng√†y mua</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <button class="btn btn-danger" id="deleteAll">‚ùå X√≥a t·∫•t c·∫£</button>
    </div>

    <!-- Modal th√™m m·ªõi -->
    <div class="modal fade" id="addModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="addForm">
            <div class="modal-header">
              <h5 class="modal-title">Th√™m giao d·ªãch</h5>
              <button type="button" class="close" data-dismiss="modal">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <input
                class="form-control mb-2"
                placeholder="Kh√°ch h√†ng"
                id="customer"
                required
              />
              <input
                class="form-control mb-2"
                placeholder="Nh√¢n vi√™n"
                id="staff"
                required
              />
              <input
                type="number"
                class="form-control mb-2"
                placeholder="S·ªë ti·ªÅn"
                id="amount"
                required
              />
              <input
                type="datetime-local"
                class="form-control"
                id="date"
                required
              />
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">L∆∞u</button>
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                H·ªßy
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Th∆∞ vi·ªán -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      let data = [
        {
          id: 2001,
          customer: "Tr·∫ßn Th·ªã Hoa",
          staff: "Ph·∫°m VƒÉn B√¨nh",
          amount: 480000,
          date: "2024-05-15 08:45",
        },
        {
          id: 2002,
          customer: "L√™ H·ªØu Th√†nh",
          staff: "ƒê·ªó Th·ªã Mai",
          amount: 220000,
          date: "2024-05-20 10:15",
        },
        {
          id: 2003,
          customer: "Nguy·ªÖn VƒÉn An",
          staff: "Nguy·ªÖn H·ªìng H√†",
          amount: 330000,
          date: "2024-06-01 09:00",
        },
        {
          id: 2004,
          customer: "Ph·∫°m Th·ªã B√≠ch",
          staff: "L√™ Trung D≈©ng",
          amount: 150000,
          date: "2024-06-08 11:20",
        },
        {
          id: 2005,
          customer: "ƒê√†o M·∫°nh H√πng",
          staff: "V≈© Th·ªã Tuy·∫øt",
          amount: 760000,
          date: "2024-06-15 13:00",
        },
      ];

      function renderTable(filter = "") {
        const tbody = $("#tableBody");
        tbody.empty();
        data
          .filter(
            (row) =>
              row.customer.toLowerCase().includes(filter.toLowerCase()) ||
              row.staff.toLowerCase().includes(filter.toLowerCase())
          )
          .forEach((row) => {
            tbody.append(`
          <tr>
            <td><input type="checkbox" class="rowCheck" data-id="${
              row.id
            }"></td>
            <td class="action-buttons">
              <button class="btn btn-sm btn-info view" data-id="${
                row.id
              }">Xem</button>
              <button class="btn btn-sm btn-warning edit" data-id="${
                row.id
              }">S·ª≠a</button>
              <button class="btn btn-sm btn-danger delete" data-id="${
                row.id
              }">X√≥a</button>
            </td>
            <td>${row.id}</td>
            <td>${row.customer}</td>
            <td>${row.staff}</td>
            <td>${row.amount.toLocaleString()}ƒë</td>
            <td>${row.date}</td>
          </tr>
        `);
          });
      }

      function generateId() {
        return Math.max(0, ...data.map((d) => d.id)) + 1;
      }

      $("#addForm").submit(function (e) {
        e.preventDefault();
        const newEntry = {
          id: generateId(),
          customer: $("#customer").val(),
          staff: $("#staff").val(),
          amount: Number($("#amount").val()),
          date: $("#date").val().replace("T", " "),
        };
        data.push(newEntry);
        renderTable();
        $("#addForm")[0].reset();
        $("#addModal").modal("hide");
      });

      $("#tableBody").on("click", ".delete", function () {
        const id = $(this).data("id");
        data = data.filter((d) => d.id !== id);
        renderTable();
      });

      $("#deleteAll").click(function () {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ kh√¥ng?")) {
          data = [];
          renderTable();
        }
      });

      $("#searchInput").on("input", function () {
        renderTable($(this).val());
      });

      $("#selectAll").on("change", function () {
        $(".rowCheck").prop("checked", $(this).prop("checked"));
      });

      $("#exportCsv").click(function () {
        let csv = "ID,Kh√°ch h√†ng,Nh√¢n vi√™n,S·ªë ti·ªÅn,Ng√†y mua\n";
        data.forEach((d) => {
          csv += `${d.id},"${d.customer}","${d.staff}",${d.amount},"${d.date}"\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "giao_dich.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });

      $(document).ready(() => renderTable());
    </script>
  </body>
</html>
